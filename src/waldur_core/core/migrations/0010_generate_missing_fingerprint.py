# Generated by Django 4.2.10 on 2024-07-21 08:41

from django.db import migrations

from waldur_core.core.models import get_ssh_key_fingerprints


def gen_fingerprint(apps, schema_editor):
    SshPublicKey = apps.get_model("core", "sshpublickey")
    for key in SshPublicKey.objects.all():
        md5_fp, sha256_fp, sha512_fp = get_ssh_key_fingerprints(key.public_key)
        key.fingerprint_md5 = md5_fp
        key.fingerprint_sha256 = sha256_fp
        key.fingerprint_sha512 = sha512_fp
        key.save(
            update_fields=[
                "fingerprint_md5",
                "fingerprint_sha256",
                "fingerprint_sha512",
            ]
        )


class Migration(migrations.Migration):
    dependencies = [
        ("core", "0009_rename_fingerprint_sshpublickey_fingerprint_md5_and_more"),
    ]

    operations = [
        migrations.RunPython(gen_fingerprint, elidable=True),
    ]
